<!DOCTYPE html>
<html>
<head>
  <title>README.md</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/bson/README.md";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

      <div class="heading h1">
        <a href="#bson-parser">BSON parser</a>
      </div>

      <div class="heading h2">
        <a href="#usage">Usage</a>
      </div>

      <div class="heading h2">
        <a href="#installation">Installation</a>
      </div>

      <div class="heading h2">
        <a href="#api">API</a>
      </div>

      <div class="heading h3">
        <a href="#bson-types">BSON types</a>
      </div>

      <div class="heading h3">
        <a href="#bson-serialization-and-deserialiation">BSON serialization and deserialiation</a>
      </div>

      <div class="heading h4">
        <a href="#bson.serialize">BSON.serialize</a>
      </div>

      <div class="heading h4">
        <a href="#bson.serializewithbufferandindex">BSON.serializeWithBufferAndIndex</a>
      </div>

      <div class="heading h4">
        <a href="#bson.calculateobjectsize">BSON.calculateObjectSize</a>
      </div>

      <div class="heading h4">
        <a href="#bson.deserialize">BSON.deserialize</a>
      </div>

      <div class="heading h4">
        <a href="#bson.deserializestream">BSON.deserializeStream</a>
      </div>

      <div class="heading h2">
        <a href="#faq">FAQ</a>
      </div>

      <div class="heading h4">
        <a href="#why-does-undefined-get-converted-to-null">Why does undefined get converted to null?</a>
      </div>

      <div class="heading h4">
        <a href="#how-do-i-add-custom-serialization-logic">How do I add custom serialization logic?</a>
      </div>

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="docs markdown"><div class="pilwrap" id="bson-parser">
  <h1>
    <a href="#bson-parser" name="bson-parser" class="pilcrow"></a>
BSON parser
  </h1>
</div>
<p>BSON is short for Bin­ary JSON and is the bin­ary-en­coded seri­al­iz­a­tion of JSON-like doc­u­ments. You can learn more about it in <a href="http://bsonspec.org">the specification</a>.</p>
<p>This browser version of the BSON parser is compiled using <a href="https://webpack.js.org/">webpack</a> and the current version is pre-compiled in the <code>browser_build</code> directory.</p>
<p>This is the default BSON parser, however, there is a C++ Node.js addon version as well that does not support the browser. It can be found at <a href="https://github.com/mongodb-js/bson-ext">mongod-js/bson-ext</a>.</p>
<div class="pilwrap" id="usage">
  <h2>
    <a href="#usage" name="usage" class="pilcrow"></a>
Usage
  </h2>
</div>
<p>To build a new version perform the following operations:</p>
<pre><code>npm install
npm run build
</code></pre>
<p>A simple example of how to use BSON in the browser:</p>
<pre><code class="html"><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./browser_build/bson.js"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="actionscript">
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">start</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">// Get the Long type</span>
    <span class="hljs-keyword">var</span> Long = BSON.Long;
    <span class="hljs-comment">// Create a bson parser instance</span>
    <span class="hljs-keyword">var</span> bson = <span class="hljs-keyword">new</span> BSON();

    <span class="hljs-comment">// Serialize document</span>
    <span class="hljs-keyword">var</span> doc = { long: Long.fromNumber(<span class="hljs-number">100</span>) }

    <span class="hljs-comment">// Serialize a document</span>
    <span class="hljs-keyword">var</span> data = bson.serialize(doc)
    <span class="hljs-comment">// De serialize it again</span>
    <span class="hljs-keyword">var</span> doc_2 = bson.deserialize(data)
  }
</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span>
</code></pre>
<p>A simple example of how to use BSON in <code>Node.js</code>:</p>
<pre><code class="js"><span class="hljs-comment">// Get BSON parser class</span>
<span class="hljs-keyword">var</span> BSON = <span class="hljs-built_in">require</span>(<span class="hljs-string">'bson'</span>)
<span class="hljs-comment">// Get the Long type</span>
<span class="hljs-keyword">var</span> Long = BSON.Long;
<span class="hljs-comment">// Create a bson parser instance</span>
<span class="hljs-keyword">var</span> bson = <span class="hljs-keyword">new</span> BSON();

<span class="hljs-comment">// Serialize document</span>
<span class="hljs-keyword">var</span> doc = { <span class="hljs-attr">long</span>: Long.fromNumber(<span class="hljs-number">100</span>) }

<span class="hljs-comment">// Serialize a document</span>
<span class="hljs-keyword">var</span> data = bson.serialize(doc)
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'data:'</span>, data)

<span class="hljs-comment">// Deserialize the resulting Buffer</span>
<span class="hljs-keyword">var</span> doc_2 = bson.deserialize(data)
<span class="hljs-built_in">console</span>.log(<span class="hljs-string">'doc_2:'</span>, doc_2)
</code></pre>
<div class="pilwrap" id="installation">
  <h2>
    <a href="#installation" name="installation" class="pilcrow"></a>
Installation
  </h2>
</div>
<p><code>npm install bson</code></p>
<div class="pilwrap" id="api">
  <h2>
    <a href="#api" name="api" class="pilcrow"></a>
API
  </h2>
</div>
<div class="pilwrap" id="bson-types">
  <h3>
    <a href="#bson-types" name="bson-types" class="pilcrow"></a>
BSON types
  </h3>
</div>
<p>For all BSON types documentation, please refer to the following sources:</p>
<ul>
<li><a href="https://docs.mongodb.com/manual/reference/bson-types/">MongoDB BSON Type Reference</a></li>
<li><a href="https://bsonspec.org/">BSON Spec</a></li>
</ul>
<div class="pilwrap" id="bson-serialization-and-deserialiation">
  <h3>
    <a href="#bson-serialization-and-deserialiation" name="bson-serialization-and-deserialiation" class="pilcrow"></a>
BSON serialization and deserialiation
  </h3>
</div>
<p><strong><code>new BSON()</code></strong> - Creates a new BSON serializer/deserializer you can use to serialize and deserialize BSON.</p>
<div class="pilwrap" id="bson.serialize">
  <h4>
    <a href="#bson.serialize" name="bson.serialize" class="pilcrow"></a>
BSON.serialize
  </h4>
</div>
<p>The BSON <code>serialize</code> method takes a JavaScript object and an optional options object and returns a Node.js Buffer.</p>
<ul>
<li><code>BSON.serialize(object, options)</code>
<ul>
<li>@param {Object} object the JavaScript object to serialize.</li>
<li>@param {Boolean} [options.checkKeys=false] the serializer will check if keys are valid.</li>
<li>@param {Boolean} [options.serializeFunctions=false] serialize the JavaScript functions.</li>
<li>@param {Boolean} [options.ignoreUndefined=true]</li>
<li>@return {Buffer} returns a Buffer instance.</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="bson.serializewithbufferandindex">
  <h4>
    <a href="#bson.serializewithbufferandindex" name="bson.serializewithbufferandindex" class="pilcrow"></a>
BSON.serializeWithBufferAndIndex
  </h4>
</div>
<p>The BSON <code>serializeWithBufferAndIndex</code> method takes an object, a target buffer instance and an optional options object and returns the end serialization index in the final buffer.</p>
<ul>
<li><code>BSON.serializeWithBufferAndIndex(object, buffer, options)</code>
<ul>
<li>@param {Object} object the JavaScript object to serialize.</li>
<li>@param {Buffer} buffer the Buffer you pre-allocated to store the serialized BSON object.</li>
<li>@param {Boolean} [options.checkKeys=false] the serializer will check if keys are valid.</li>
<li>@param {Boolean} [options.serializeFunctions=false] serialize the JavaScript functions.</li>
<li>@param {Boolean} [options.ignoreUndefined=true] ignore undefined fields.</li>
<li>@param {Number} [options.index=0] the index in the buffer where we wish to start serializing into.</li>
<li>@return {Number} returns the index pointing to the last written byte in the buffer.</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="bson.calculateobjectsize">
  <h4>
    <a href="#bson.calculateobjectsize" name="bson.calculateobjectsize" class="pilcrow"></a>
BSON.calculateObjectSize
  </h4>
</div>
<p>The BSON <code>calculateObjectSize</code> method takes a JavaScript object and an optional options object and returns the size of the BSON object.</p>
<ul>
<li><code>BSON.calculateObjectSize(object, options)</code>
<ul>
<li>@param {Object} object the JavaScript object to serialize.</li>
<li>@param {Boolean} [options.serializeFunctions=false] serialize the JavaScript functions.</li>
<li>@param {Boolean} [options.ignoreUndefined=true]</li>
<li>@return {Buffer} returns a Buffer instance.</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="bson.deserialize">
  <h4>
    <a href="#bson.deserialize" name="bson.deserialize" class="pilcrow"></a>
BSON.deserialize
  </h4>
</div>
<p>The BSON <code>deserialize</code> method takes a Node.js Buffer and an optional options object and returns a deserialized JavaScript object.</p>
<ul>
<li><code>BSON.deserialize(buffer, options)</code>
<ul>
<li>@param {Object} [options.evalFunctions=false] evaluate functions in the BSON document scoped to the object deserialized.</li>
<li>@param {Object} [options.cacheFunctions=false] cache evaluated functions for reuse.</li>
<li>@param {Object} [options.cacheFunctionsCrc32=false] use a crc32 code for caching, otherwise use the string of the function.</li>
<li>@param {Object} [options.promoteLongs=true] when deserializing a Long will fit it into a Number if it's smaller than 53 bits</li>
<li>@param {Object} [options.promoteBuffers=false] when deserializing a Binary will return it as a Node.js Buffer instance.</li>
<li>@param {Object} [options.promoteValues=false] when deserializing will promote BSON values to their Node.js closest equivalent types.</li>
<li>@param {Object} [options.fieldsAsRaw=null] allow to specify if there what fields we wish to return as unserialized raw buffer.</li>
<li>@param {Object} [options.bsonRegExp=false] return BSON regular expressions as BSONRegExp instances.</li>
<li>@return {Object} returns the deserialized Javascript Object.</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="bson.deserializestream">
  <h4>
    <a href="#bson.deserializestream" name="bson.deserializestream" class="pilcrow"></a>
BSON.deserializeStream
  </h4>
</div>
<p>The BSON <code>deserializeStream</code> method takes a Node.js Buffer, <code>startIndex</code> and allow more control over deserialization of a Buffer containing concatenated BSON documents.</p>
<ul>
<li><code>BSON.deserializeStream(buffer, startIndex, numberOfDocuments, documents, docStartIndex, options)</code>
<ul>
<li>@param {Buffer} buffer the buffer containing the serialized set of BSON documents.</li>
<li>@param {Number} startIndex the start index in the data Buffer where the deserialization is to start.</li>
<li>@param {Number} numberOfDocuments number of documents to deserialize.</li>
<li>@param {Array} documents an array where to store the deserialized documents.</li>
<li>@param {Number} docStartIndex the index in the documents array from where to start inserting documents.</li>
<li>@param {Object} [options.evalFunctions=false] evaluate functions in the BSON document scoped to the object deserialized.</li>
<li>@param {Object} [options.cacheFunctions=false] cache evaluated functions for reuse.</li>
<li>@param {Object} [options.cacheFunctionsCrc32=false] use a crc32 code for caching, otherwise use the string of the function.</li>
<li>@param {Object} [options.promoteLongs=true] when deserializing a Long will fit it into a Number if it's smaller than 53 bits</li>
<li>@param {Object} [options.promoteBuffers=false] when deserializing a Binary will return it as a Node.js Buffer instance.</li>
<li>@param {Object} [options.promoteValues=false] when deserializing will promote BSON values to their Node.js closest equivalent types.</li>
<li>@param {Object} [options.fieldsAsRaw=null] allow to specify if there what fields we wish to return as unserialized raw buffer.</li>
<li>@param {Object} [options.bsonRegExp=false] return BSON regular expressions as BSONRegExp instances.</li>
<li>@return {Number} returns the next index in the buffer after deserialization <strong>x</strong> numbers of documents.</li>
</ul>
</li>
</ul>
<div class="pilwrap" id="faq">
  <h2>
    <a href="#faq" name="faq" class="pilcrow"></a>
FAQ
  </h2>
</div>
<div class="pilwrap" id="why-does-undefined-get-converted-to-null">
  <h4>
    <a href="#why-does-undefined-get-converted-to-null" name="why-does-undefined-get-converted-to-null" class="pilcrow"></a>
Why does <code>undefined</code> get converted to <code>null</code>?
  </h4>
</div>
<p>The <code>undefined</code> BSON type has been <a href="http://bsonspec.org/spec.html">deprecated for many years</a>, so this library has dropped support for it. Use the <code>ignoreUndefined</code> option (for example, from the <a href="http://mongodb.github.io/node-mongodb-native/2.2/api/MongoClient.html#connect">driver</a> ) to instead remove <code>undefined</code> keys.</p>
<div class="pilwrap" id="how-do-i-add-custom-serialization-logic">
  <h4>
    <a href="#how-do-i-add-custom-serialization-logic" name="how-do-i-add-custom-serialization-logic" class="pilcrow"></a>
How do I add custom serialization logic?
  </h4>
</div>
<p>This library looks for <code>toBSON()</code> functions on every path, and calls the <code>toBSON()</code> function to get the value to serialize.</p>
<pre><code class="javascript"><span class="hljs-keyword">var</span> bson = <span class="hljs-keyword">new</span> BSON();

<span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">CustomSerialize</span> </span>{
  toBSON() {
    <span class="hljs-keyword">return</span> <span class="hljs-number">42</span>;
  }
}

<span class="hljs-keyword">const</span> obj = { <span class="hljs-attr">answer</span>: <span class="hljs-keyword">new</span> CustomSerialize() };
<span class="hljs-comment">// "{ answer: 42 }"</span>
<span class="hljs-built_in">console</span>.log(bson.deserialize(bson.serialize(obj)));
</code></pre>
</div>
  </div>
</body>
</html>
